@startuml
allowmixing
skinparam componentStyle rectangle

' ============ АКТЁРЫ ============
actor "Лаборатория" as Lab
actor "Администратор" as Admin

' ============ СИСТЕМЫ / ХРАНИЛИЩА ============
entity "Зашифрованное хранилище" as Vault {
  [RegistryByDate.xlsx #PHI]
  [Data file - Пациент.pdf #PHI]
  [Результаты_анализов.jpg #PHI]
}

database "DLP-система" as DLP

' ============ ПРОЦЕССЫ ============
rectangle "Учёт лабораторных результатов" {
  action [1. Получение результатов] as ReceiveResults
  action [2. Сканирование и тегирование] as ScanTag
  action [3. Сохранение в реестр] as SaveToRegistry
}

' ============ ПОТОКИ ДАННЫХ ============
Lab --> ReceiveResults : Передаёт бумажные результаты
ReceiveResults --> ScanTag : Передаёт документы
ScanTag --> ScanTag : Сканирование в PDF/JPG
ScanTag --> ScanTag : Автоматическое тегирование #PHI
ScanTag --> Vault : Сохраняет в папку пациента
ScanTag --> SaveToRegistry : Передаёт данные для реестра
SaveToRegistry --> Vault : Добавляет в RegistryByDate.xlsx
SaveToRegistry --> DLP : Запрос на проверку экспорта

' ============ КОММЕНТАРИИ ============
note left of ScanTag
  Система автоматически:
  - Распознаёт тип документа (анализ)
  - Применяет тег #PHI
  - Шифрует при сохранении
end note

note right of Vault
  Доступ только у:
  - Врачей
  - Администраторов с доступом к лаборатории
end note

note right of DLP
  <b>Мониторинг тегов #PHI</b>
  Блокировка копирования

  Если файл помечен #PHI:
  - Запрещается копирование в буфер
  - Блокируется отправка по email
  - Требуется двухфакторное подтверждение
end note

title "DFD: Учёт лабораторных результатов с защитой"
footer Источник: "Медикаменте" | Версия: 1.0
@enduml
